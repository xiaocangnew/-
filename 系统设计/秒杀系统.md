### 高并发核心- 订单与库存
1.下单同时预占库存
2.支付
3.支付成功真正减扣库存
4.取消订单,回退预占库存

- 如何安全的扣减库存?
1.使用了数据库的乐观锁来控制库存安全更新库存的语句，在并发量不是很大的情况下可以这么做。
  但是如果是秒杀，瞬时流量很高的话，压力会都到数据库，可能拖垮数据库。
   具体操作：增加availableNum>0, availableNum - num >= 0； 这个类似版本号
2.使用分布式锁(强制把处理请求串行化)； 缺点是并发不高，用户体验不好.
3.利用Redis increment的原子操作 + 乐观锁；(事前把库存load到redis中，先扣减redis数量，再更新库)
4.db性能扛不住时降级为写扣减DB库存消息到本机，然后本机通过异步进行DB库存扣减，