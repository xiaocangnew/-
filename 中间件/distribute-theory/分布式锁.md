### 分布式锁类型
1. redis分布式锁
2. zookeeper分布式锁

### 分布式锁要素
1. 不会发生死锁，宕机可以自动释放锁
2. 加锁和解锁必须是同一个客户端；
3. 性能考虑；
4. 锁的基本要素；

### redis锁 VS zookeeper锁
- redis的分布式锁，
   - 缺点：
      1. 它获取锁的方式简单粗暴，获取不到锁直接不断尝试获取锁，比较消耗性能。
      2. redis的设计定位决定了它的数据并不是强一致性的，cluster/master-slave架构主从异步复制问题：
         在redis master实例宕机的时候，可能导致多个客户端同时完成加锁。
         即便使用redlock算法来实现,也无法保证其实现100%没有问题.
   - 优点
     1. 使用redis实现分布式锁在很多企业中非常常见，而且大部分情况下都不会遇到所谓的“极端复杂场景”
     2. 最重要的一点是redis的性能很高，可以支撑高并发的获取、释放锁操作。

- zk分布式锁
   - 优点
     1. zookeeper天生设计定位就是分布式协调，强一致性。锁的模型健壮、简单易用、适合做分布式锁。
     2. 如果获取不到锁，只需要添加一个监听器就可以了，不用一直轮询，性能消耗较小。
   - 缺点：
     1. 如果有较多的客户端频繁的申请加锁、释放锁，对于zk集群的压力会比较大。
     2. 需要设置好会话超时时间，否则可能失去链接导致释放锁，出现问题。 更新sql时要加版本号。
     

### redLock实现
1. 2n+1个redis实例， 使用同样key值，在超过一半的实例中执行成功;
2. TTL时长 要大于正常业务执行的时间+获取所有redis服务消耗时间+时钟漂移