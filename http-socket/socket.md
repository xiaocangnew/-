### 零拷贝技术
- 基础知识点：
   - 户态和内核态
      处于用户态执行时，能访问的内存空间和对象受到限制，占有的处理器是可被抢占的
      处于内核态执行时，能访问所有的内存空间和对象，   占有的处理器是不允许被抢占的
   - DMA（Direct Memory Access）直接内存访问
      DMA允许外设组件将I/O数据直接传送到主存储器中；并且传输不需要CPU的参与，来释放CPU时间分片资源。
   
- 优化线
   - (用户在网上浏览信息)为例收到请求后的数据流：
      磁盘文件--(DMA copy)--> 内核态ReadBuffer --(cpu copy)-->用户态AppBuffer --(cpu copy)-->内核态socketBuffer--(DMA copy)--> 网络上NicBuffer
   - 痛点：
      1. 两次cpu copy占用cpu时间
      2. 需要从内核态和用户态切换
   - Linux2.1 内核优化：
        跳过AppBuffer步骤(mmap技 术,实现数据共享)，直接从ReadBuffer--(cpu copy)-->socketBuffer
   - Linux2.4 内核优化: 
        操作系统提供scatter/gather这种DMA的方式，来从内核空间缓冲区中将数据直接读取到协议引擎,消除了最后一次cpu copy
        socketBuffer不再copy信息，里面只有数据的位置和长度的信息的描述符，
   n
- 注意：零拷贝其实是根据内核状态划分的，
   1. 数据在用户态的状态下，经历了零次拷贝，所以才叫做零拷贝，
   2. 不是说不拷贝。
 
 ### IO 多路复用模型：  select， poll， epoll  
- 多路复用本质上是同步I/O， 因为他们都需要在读写事件就绪后自己负责进行读写，也就是说这个读写过程是阻塞的，
   多路复用指用一个线程实现多个io读写； 
   异步I/O则无需自己负责进行读写，异步I/O的实现会负责把数据从内核拷贝到用户空间

- select本质上是通过设置或者检查存放fd标志位的数据结构来进行下一步处理, 缺点：
   - 1. 单个进程可监视的fd数量被限制，即能监听端口的大小有限。
        一般来说这个数目和系统内存关系很大，具体数目可以cat /proc/sys/fs/file-max察看。32位机默认是1024个。64位机默认是2048.
   - 2. 对socket进行扫描时是线性扫描，即采用轮询的方法，效率较低：
     （1）每次调用select，都需要把fd集合从用户态拷贝到内核态，这个开销在fd很多时会很大
     （2）同时每次调用select都需要在内核遍历传递进来的所有fd，这个开销在fd很多时也很大
   - 3. 需要维护一个用来存放大量fd的数据结构，这样会使得用户空间和内核空间在传递该结构时复制开销大

- poll
    - poll的实现和select相同点：
        - 它将用户传入的数组拷贝到内核空间，然后查询每个fd对应的设备状态，如果设备就绪则在设备等待队列中加入一项并继续遍历，如果遍历完所有fd后没有发现就绪设备，则挂起当前进程，直到设备就绪或者主动超时，被唤醒后它又要再次遍历fd
        - poll和select同样存在一个缺点: 包含大量文件描述符的数组被整体复制于用户态和内核的地址空间之间，而不论这些文件描述符是否就绪，它的开销随着文件描述符数量的增加而线性增大。
    - poll和select的不同：
        - 描述fd集合的方式不同，poll使用pollfd结构而不是select的fd_set结构
        - poll没有最大文件描述符数量的限制, 原因是它是基于链表来存储。但是同样有一个缺点：
          - 大量的fd的数组被整体复制于用户态和内核地址空间之间，而不管这样的复制是不是有意义。                   
          - poll还有一个特点是“水平触发”，如果报告了fd后，没有被处理，那么下次poll时会再次报告该fd。

- epoll
    - 有两种模式， LT(水平触发，fd事件如果没被处理，则下次epoll继续报告该fd)，ET(高速模式，fd的事件只会上报一次)
    - epoll的优点：
      1、没有最大并发连接的限制，能打开的FD的上限远大于1024（1G的内存上能监听约10万个端口）；
      2、效率提升，不是轮询的方式，基于回调函数注册方式,只有活跃可用的FD才会调用callback函数；即Epoll最大的优点就在于它只管你“活跃”的连接，而跟连接总数无关，
      3、内存拷贝，利用mmap()文件映射内存加速与内核空间的消息传递；即epoll使用mmap减少复制开销。
     
 
 
 